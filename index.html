<!DOCTYPE html>
<html>
<head>
	<script src="airtable.browser.js"></script>
	<script src="https://static.airtable.com/js/embed/embed_snippet_v1.js"></script>
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.0/jquery.min.js"></script>
	<!-- <script type="text/javascript" src="bike_project_navigator.js"></script> -->
	<!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script> -->

	<style>
		.selected {
		    color: black;
		}
		.notSelected {
		    color: grey;
		}
		.title {
		    font-weight: bold;
		}
	</style>
</head>

<body>
	<div style="font-size: 2vw">
		<a class="title"> Outcome: </a> </br>
		Establish bicycling as a safe and common transportation method in the United States
	</div>
	<div>
		<span>
			<ul id="whatList"  style="list-style-type: none; display: inline-block;  font-size: 2vw; vertical-align: top;"> 
			</ul>
			<ul id="howList"  style="list-style-type: none; display: inline-block; font-size: 2vw; vertical-align: top;"> 
			</ul>
		</span>
	</div>
	<div>
		<span>
			<ul id="effortList"  style="list-style-type: none; display: inline-block; font-size: 1vw; vertical-align: top;"> 
			</ul>
			<ul id="mediaList"  style="list-style-type: none; display: inline-block; font-size: 1vw; vertical-align: top;"> 
			</ul>
		</span>
	</div>
	<button id="effortFormButton" onclick="showEffortForm()">Add a new effort</button>
	<button id="mediaFormButton" onclick="showMediaForm()">Add a new story/article</button>
	<iframe id='effortForm' class="airtable-embed airtable-dynamic-height" src="https://airtable.com/embed/shrkkmCJlmRWY3drd?backgroundColor=gray" frameborder="0" onmousewheel="" width="50%"  style="background: transparent; border: 1px solid #ccc; display: none;" ></iframe>
	<iframe id='mediaForm' class="airtable-embed airtable-dynamic-height" src="https://airtable.com/embed/shrQb3TwZJ2dWlCH9?backgroundColor=gray" frameborder="0" onmousewheel="" width="50%"  style="background: transparent; border: 1px solid #ccc; display: none;" ></iframe>
	<div style="  height:30px;  padding:5px; bottom:0px;"">
		Created by Scott Owades.
		<a href="https://airtable.com/shrK4deyUvmUA9rcJ">Source data </a>

	</div>
</body>
<script type="text/javascript">

var Airtable = require('airtable');
// This is a read-only API key...don't get excited
var base = new Airtable({apiKey: 'keyt2DL8nfcAyl338'}).base('appVtB7KozrwvMKQm');

base('What').select({
    view: 'Grid view'
}).firstPage(function(err, records) {
    if (err) { console.error(err); return; }
    createTitle("Strategies:","whatList");
    records.forEach(function(record) {
        var what = record.get('What to do')
        var listPart = document.createElement("li");
        listPart.onclick = function() {
            return function(){
                showHows(what);
                const selectedElement = this.parentElement.getElementsByClassName('selected')
                const notSelectedElements = this.parentElement.children
                Array.from(selectedElement).forEach(item => item.classList.remove('selected')) 
                Array.from(notSelectedElements).forEach(item => item.classList.add('notSelected'))  
                this.classList.remove('notSelected');
                this.classList.add('selected');
            }
        }(what);
        var textNode = document.createTextNode(what);
        listPart.appendChild(textNode);
        document.getElementById("whatList").appendChild(listPart);
    });
});

function showHows(what) {
    document.getElementById("howList").textContent = ''
    document.getElementById("effortList").textContent = ''
    document.getElementById("mediaList").textContent = ''
    var filterFormula = "AND( {What} = '" + what + "', {Reviewed} = 'Yes')"
    base('How').select({
        view: 'Grid view',
        filterByFormula: filterFormula

    }).firstPage(function(err, records) {
        if (err) { console.error(err); return; }
    createTitle("Approaches:","howList");
        records.forEach(function(record) {
            var how = record.get('How')
            var listPart = document.createElement("li");
            listPart.onclick = function() {
                return function(){
                    showEfforts(how);
                    showMedia(how);
                    const selectedElement = this.parentElement.getElementsByClassName('selected')
                    const notSelectedElements = this.parentElement.children
                    Array.from(selectedElement).forEach(item => item.classList.remove('selected')) 
                    Array.from(notSelectedElements).forEach(item => item.classList.add('notSelected'))  
                    this.classList.remove('notSelected');
                    this.classList.add('selected');
                }
            }(how);
            var textNode = document.createTextNode(how);
            listPart.appendChild(textNode);
            document.getElementById("howList").appendChild(listPart);
        });
    });
}

function showEfforts(how) {
    document.getElementById("effortList").textContent = ''
    var filterFormula = "AND(SEARCH('"+ how + "',{How}) > 0, {Reviewed} = 'Yes')"
    base('Efforts').select({
        view: 'Grid view',
        filterByFormula: filterFormula
    }).firstPage(function(err, records) {
        if (err) { console.error(err); return; }
        createTitle("Efforts:","effortList");
        records.forEach(function(record) {
            var effort = record.get('Effort')
            var url = record.get('URL')
            var listPart = document.createElement("li");
            var a = document.createElement("a");
            a.textContent = effort;
            a.setAttribute('href', url);
            listPart.appendChild(a);
            document.getElementById("effortList").appendChild(listPart);
        });
    });
}
function showMedia(how) {
    document.getElementById("mediaList").textContent = ''
    var filterFormula = "AND( SEARCH('"+ how + "',{How}) > 0, {Reviewed} = 'Yes')"
    base('Media').select({
        view: 'Grid view',
        filterByFormula: filterFormula
    }).firstPage(function(err, records) {
        if (err) { console.error(err); return; }
        createTitle("Media:","mediaList");
        records.forEach(function(record) {
            var media = record.get('Media')
            var url = record.get('URL')
            var listPart = document.createElement("li");
            var a = document.createElement("a");
            a.textContent = media;
            a.setAttribute('href', url);
            listPart.appendChild(a);
            document.getElementById("mediaList").appendChild(listPart);
        });
    });
}

function createTitle(title,list) {
    var listPart = document.createElement("li");
    var textNode = document.createTextNode(title);
    listPart.appendChild(textNode);
    listPart.classList.add('title');
    document.getElementById(list).appendChild(listPart);
}

// try this example for better effects: http://jsfiddle.net/B4JGe/
function showEffortForm() {
	var x = document.getElementById("effortForm");
	var y = document.getElementById("effortFormButton");
	if (x.style.display === "none") {
	x.style.display = "block";
	y.innerHTML = "Hide new effort form"
	} else {
	x.style.display = "none";
	y.innerHTML = "Add a new effort"
	}
}

function showMediaForm() {
	var x = document.getElementById("mediaForm");
	var y = document.getElementById("mediaFormButton");
	if (x.style.display === "none") {
	x.style.display = "block";
	y.innerHTML = "Hide new story/article form"
	} else {
	x.style.display = "none";
	y.innerHTML = "Add a new story/article"
	}
}
</script>
</html>